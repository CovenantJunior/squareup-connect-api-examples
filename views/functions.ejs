<%
/**
 * Helper function to format time from milliseconds to human readable text
 * E.g. 5400000 milliseconds to "1 hour 30 mins".
 * @param {Number} durationInMs
 */
formatTime = function(durationInMs) {
  const duration = Number(durationInMs);
  const minutes = Math.floor(duration / (1000 * 60) % 60);
  const hours = Math.floor(duration / (1000 * 60 * 60) % 24);

  let msg = [];
  if (hours > 0) {
    msg.push(hours);
    msg.push((hours > 1) ? "hours" : "hour");
  }

  if (minutes > 0) {
    msg.push(minutes);
    msg.push((minutes > 1) ? "mins" : "min");
  }

  if (msg.length > 0) {
    return msg.join(" ");
  } else {
    return "Unknown duration"
  }
}

/**
 * Helper function to format money into appropriate currency and rounding.
 * If the value is an integer (i.e. no decimal places), do not show `.00`.
 * @param {Number} value the amount
 * @param {String} currency the currency code
 */
formatMoney = function(value, currency) {
  let valueAsNumber = Number(value);
  // Create number formatter.
  const props = {
    style: 'currency',
    currency: currency,
    minimumFractionDigits: 2
  };
  // If the value is an integer, show no decimal digits.
  if (valueAsNumber % 1 == 0) {
    props.minimumFractionDigits = 0;
  }
  
  // Some currencies don't need to use higher denominations to represent values.
  if (currency !== "JPY") {
    valueAsNumber /= 100.0;
  }
  var formatter = new Intl.NumberFormat('en-US', props);
  return formatter.format(valueAsNumber);
}

/**
 * Helper function to get the initials of a staff member based on their display name
 *
 * @param {String} displayName the display name of the staff
 */
getStaffInitials = function(displayName) {
  return displayName.toUpperCase()[0];
}

/**
 * Helper function to convert date into a human readable date 
 * 
 * e.g. 2021-07-09T16:00:00Z -> Friday, July 09, 2021
 * 
 * @param {String} date the date to parse
 */
convertDateToText = function(date) {
  const d = new Date(date);
  const weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

  const weekday = weekdays[d.getDay()];
  const month = months[d.getMonth()];
  const day = d.getDate();
  const year = d.getFullYear();

  let ordinalIndicator = "th";
  const lastChar = day.toString().charAt(day.toString().length-1);

  if (lastChar === "1") {
    ordinalIndicator = "st";
  } else if (lastChar === "2") {
    ordinalIndicator = "nd";
  } else if (lastChar === "3") {
    ordinalIndicator = "rd";
  }

  return `${weekday}, ${month} ${day}${ordinalIndicator}, ${year}`;
}

convertTimeToText = function(date) {
  const d = new Date(date);

  let hours = d.getHours();
  let minutes = d.getMinutes();

  hours = hours % 12 ? hours % 12 : 12;
  minutes = minutes < 10 ? "0" + minutes : minutes;

  return `${hours}:${minutes} ${d.getHours() >= 12 ? "pm" : "am"}`;
}

/**
* Retrieve the local time zone in IANA format
*/
getLocalTimezone = function() {
  return Intl.DateTimeFormat().resolvedOptions().timeZone;
}

/**
 * A helper function to stringify JSON objects that contains bigint.
 */
stringifyJSON = function(data) {
  return JSON.stringify(data, (key, value) =>
    typeof value === "bigint" ? value.toString() : value
  );
}
%>